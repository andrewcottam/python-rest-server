<html>
	<head>
		<title>REST Services Directory Help</title>
		<link rel="stylesheet" type="text/css" href="styles/styles.css" />
	</head> 
	<body>
		<div class="title">
			<span style="vertical-align: super">REST Services Directory Help</span>
		</div>
		<div style="margin: 20px">
			<!-- <div class="toc1">
				<a href="#background">Background</a>
			</div>
			<div class="toc1">
				<a href="#understanding">Understanding the REST Services Directory</a>
			</div>
			<div class="toc2">
				<a href="#rr">REST request</a>
			</div>
			<div class="toc3">
				<a href="#ipdt">Input parameter data types</a>
			</div>
			<div class="toc3">
				<a href="#sop">Standard optional parameters</a>
			</div>
			<div class="toc3">
				<a href="#spv">Specifying parameter values</a>
			</div>
			<div class="toc2">
				<a href="#rr2">REST response</a>
			</div>
			<div class="toc3">
				<a href="#metadata">Metadata section</a>
			</div>
			<div class="toc3">
				<a href="#opdt">Output parameter data types</a>
			</div>
			<div class="toc3">
				<a href="#rs">Records section</a>
			</div>
			<div class="toc1">
				<a href="#consuming">Consuming REST Services</a>
			</div>
			<div class="toc2">
				<a href="#websites">Consuming REST services in websites</a>
			</div>
			<div class="toc3">
				<a href="#ud">Using Dojo</a>
			</div>
			<div class="toc3">
				<a href="#ue">Using extJS</a>
			</div>
			<div class="toc2">
				<a href="#desktop">Consuming REST services in desktop tools</a>
			</div>
			<div class="toc1">
				<a href="#publishing">Publishing REST Services</a>
			</div>
			<div class="toc2">
				<a href="#b2">Background</a>
			</div>
			<div class="toc2">
				<a href="#sbssp">Step-by-step service publishing</a>
			</div>
			<div class="toc2">
				<a href="#hadoop">Publishing Hadoop resources using a Postgresql wrapper</a>
			</div> 
			<div class="toc2">
				<a href="#lac">Licensing and Copyright</a>
			</div>
			<div class="toc1">
				<a href="#s">Support</a>
			</div> -->
			<h2><a name="background">Background</a></h2>
			<div class="normal">
				This document contains information for developers and software engineers on the JRC REST Services Directory. The REST Services Directory is a catalog of information services available from JRC that can be used within information systems such as websites, desktop software and client applications. The services provide a wide range of information produced by JRC in the public domain and within specific thematic areas, e.g. biodiversity, land resource management etc. All of these services are available over the internet as simple URLs.  
			</div>
			<div class="normal">
				This help document provides information for both providers and consumers of the REST Services. For details on how to publish your data through REST services, see <a href="#publishing">here</a>. For details on how to access and use the services see the <a href="#consuming">following section</a>.
			</div>
			<h2><a name="understanding">Understanding the REST Services Directory</a></h2>
			<div class="normal">
				There are many ways in which the REST Services can be consumed and used from applications, websites and tools etc. REST, short for Representational State Transfer, provides a simple, open Web interface to services hosted by JRC.
				All services exposed by the REST Services Directory are accessible through a hierarchy of endpoints or Uniform Resource Locators (URLs) for each service published at JRC.</div>
			<div class="normal"> When using the REST Services, you typically start a the root level which shows all of the databases that have REST Services available. Clicking on one of these databases then shows you the next level down in the REST Services Directory which are the schemas for that database. 
				These describe the thematic areas within that database where the services are located. Clicking on the schema then shows you all of the available REST Services that are available within that particular schema.
			</div>
			<!-- <div class="restimg"><img src='images/rest2.png'>
			</div> -->
			<div class="normal">
				The final level in the REST Services hierarchy is the service level itself which includes detailed information on each individual service in the directory. This page includes a description of the service, the input and output parameters and some example calls.
				The url for the service page is the endpoint for the service and this is the address that you will use to consume the service. In order to consume the service you will also need to pass in a number of parameters which are described in the next section.
			</div>
			<!-- <div class="restimg"><img src='images/rest3.png'>
			</div> -->
			<h3><a name="rr">REST request</a></h3>
			<div class="normal">
				REST requests can be created using the information on the service page. The list of parameters for the service includes the input parameters that you must pass to the service and the output parameters that are returned from the server (if specified in the <span class='param'>fields</span> parameter). For the input parameters, a service
				can have mandatory parameters and optional parameters (the parameter name is in italics for optional parameters). For each of the parameters the following information is given:
			</div>
			<table class="table" cellspacing="0">
				<tr>
					<td><b>Name</td><td>The name of the parameter (optional parameters are shown in italics)</td>
				</tr>
				<tr>
					<td><b>Description</b></td><td>A full description of the parameter</td>
				</tr>
				<tr>
					<td><b>Type</b></td><td>The data type of the parameter. See the section on input parameter data types below. </td>
				</tr>
				<tr>
					<td><b>Default value</b></td><td>(<i>input only</i>) If a parameter is optional then a default value will be specified in this column. Default values are values that will be included in the REST request if not explicitly specified. </td>
				</tr>
			</table>
			<h4><a name="ipdt">Input parameter data types</a></h4>
			<div class="normal">
				All services contain input parameters with specific data types which must be complied with in order to use the services succesfully. The following data types are supported for input parameters:
			</div>
			<table class="table" cellspacing="0">
				<tr>
					<th>Data type</th><th>Represents</th><th>Encoding</th><th>Example</th>
				</tr>
				<tr>
					<td>integer</td><td>Positive 4 byte integer value</td><td>None</td><td>wdpa_id=785</td>
				</tr>
				<tr>
					<td>string</td><td>Variable length characer data</td><td>None</td><td>rl_status=EN</td>
				</tr>
				<tr>
					<td>double</td><td>Double precision number</td><td>None</td><td>percent=20.62</td>
				</tr>
				<tr>
					<td>array</td><td>Variable length array of strings or integers</td><td>Using commas to separate the items</td><td>rl_status=EN,CR</td>
				</tr>
				<tr>
					<td>date</td><td>Date only</td><td>Encoded as a string using a mm/dd/yyyy date format</td><td>startdate=03/31/2012</td>
				</tr>
				<tr>
					<td>datetime</td><td>Date and time</td><td>Encoded as a string using a mm/dd/yyyy hh:mm:ss timedate format</td><td>startdate=03/31/2012 10:15:25</td>
				</tr>
				<tr>
					<td>enumeration</td><td>Discrete set of valid values</td><td>String</td><td>format=json</td>
				</tr>
			</table>
			<div class="normal">
				For example, the following REST Service call includes two parameters (one a mandatory integer and one an optional array of numbers) and returns a list of species for a particular protected area:
			</div>
			<div class='code'>
				http://dopa-services.jrc.ec.europa.eu/services/ibex/especies/get_pa_species_list?wdpa_id=785&category=EN,CR
			</div>
			<h4><a name="sop">Standard optional parameters</a></h4>
			<div class="normal">
				For all REST services there are a number of standard optional parameters that can also be specified in the REST service call:
			</div>
			<table class="table" cellspacing="0">
				<tr>
					<th>Name</th><th>Description</th><th>Default value</th>
				</tr>
				<tr>
					<td>format</td><td>The <span class='param'>format</span> parameter is used to specify the response format and can be one of the following values:
					<ul>
						<li>
							json - This format is a standard Javascript based format widely used in REST services where the information is encoded within objects and arrays.
						</li>
						<li>
							array - Identical to the json format except that the field names are not repeated for each record thus keeping the size of the return data to a minimum. The field names can be retrieved using the metadata section of the response.
						</li>
						<li>
							xml - A standard format type for web services and includes the information in elements and attributes. Currently, the xml format does not include a metadata section.
						</li>
						<li>
							xmlverbose - A standard format type for web services which in this case includes all data in nested elements. Currently, the xml format does not include a metadata section.
						</li>
						<li>
							pdf - Adobe Acrobat format which can be used for printing
						</li>
						<li>
							html - web page format
						</li>
						<li>
							csv - Simple comma-delimited format for easy import into databases and spreadsheets
						</li>
					</ul> If an invalid value is used then an 'Invalid response format' error is returned. </td><td>json</td>
				</tr>
				<tr>
					<td>fields</td><td>The <span class='param'>fields</span> parameter is used to determine the fields that are returned and is encoded as a comma-separated list of field names. These field names must match one or more of the output parameters listed in the service description. The fields parameter also determines the order in which the output fields are returned.
					<br>
					<br>
					If an invalid field is requested then an 'Invalid output fields' error is returned. </td><td>all fields</td>
				</tr>
				<tr>
					<td>sortfield</td><td>
					<div class="normal">
						The sortfield parameter specifies the field that will be used to sort the returned records. If no sortfield is specified the results are returned in the default sort order as specified in the database function.
					<br>
					<br>
					If an invalid sortfield is requested then an 'Invalid sortfield' error is returned. 
					</td><td></td>
				</tr>
				<tr>
					<td>dplimit</td><td>The <span class='param'>dplimit</span> parameter specifies the number of decimal places that any floating point values are rounded to in the resulting data. This parameters only applies to fields of type='float' and does not apply to fields with the names 'lat' or 'lng'. These are assumed to represent latitude and longitude values. </td><td>2</td>
				</tr>
				<tr>
					<td>includemetadata</td><td>
					<div class="normal">
						The <span class='param'>includemetadata</span> parameter sets whether to include a metadata section in the response which includes summary information about the results. See the <a href="#metadata">metadata section</a> for more information.
					</td><td>true</td>
				</tr>
				<tr>
					<td>parseparams</td><td>The <span class='param'>parseparams</span> parameter sets whether to parse the input parameters in the service call. If true then input parameter names are validated against the database and invalid parameters will raise errors. If false then parameters with invalid names will be ignored by the server.</td><td>true</td>
				</tr>
				<tr>
					<td>metadataname</td><td>The <span class='param'>metadataname</span> parameter determines the name of the metadata object that is returned. For extJS clients this should be set to 'metaData'.</td><td>metadata</td>
				</tr>
				<tr>
					<td>rootname</td><td>The <span class='param'>rootname</span> parameter determines the name of the root section that contains all of the actual records that are returned. </td><td>records</td>
				</tr>
			</table>
			<div class="normal">
				For example, the following REST Service call includes values for all optional parameters :
			</div>
			<div class="code">
				http://dopa-services.jrc.ec.europa.eu/services/ibex/especies/get_pa_species_list?wdpa_id=785&category=EN,CR&format=json&fields=iucn_species_id&sortfield=taxon&dplimit=3&includemetadata=true&parseparams=true&metadataname=md&rootname=r
			</div>
			<h4><a name="spv">Specifying parameter values</a></h4>
			<div class="normal">
				Parameter values for the REST Service calls can be done by simply appending the parameter values to the end of the service end point as a set of key/value pairs preceeded by a question mark. There are example calls in each of the service pages that
				show the syntax for calling a particular service (both using mandatory and optional parameters). All mandatory parameter values must be specified, and all data types must be adhered to otherwise the service call will fail. Parameters can be specified in any order (both mandatory and optional) and
				any parameters whose names do not match those of the input/output parameters will return an error (unless the parseparams flag is set to false). If mandatory parameters are missing or values are invalid then the server will return an error. Finally, parameter values are case sensitive, e.g. category=VU and <i>not</i> category=vu.
			</div>
			<h3><a name="rr2">REST response</a></h3>
			<div class="normal">
				The REST response from the server will include all of the data and also an optional metadata section (specified by the <span class='param'>includemetadata</span> parameter). The sample below shows a typical json response:
			</div>
			<div class='code'>
				{
				<br/>
				&nbsp;"records": [
				<br/>
				&nbsp;&nbsp;{
				<br/>
				&nbsp;&nbsp;&nbsp;"iucn_species_id": 150726,
				<br/>
				&nbsp;&nbsp;&nbsp;"taxon": "Abroscopus superciliaris",
				<br/>
				&nbsp;&nbsp;&nbsp;"min_presence_id": 2,
				<br/>
				&nbsp;&nbsp;&nbsp;"kingdom": "ANIMALIA",
				<br/>
				&nbsp;&nbsp;&nbsp;"phylum": "CHORDATA",
				<br/>
				&nbsp;&nbsp;&nbsp;"class": "AVES",
				<br/>
				&nbsp;&nbsp;&nbsp;"order": "Passeriformes",
				<br/>
				&nbsp;&nbsp;&nbsp;"family": "Sylviidae",
				<br/>
				&nbsp;&nbsp;&nbsp;"status": "LC",
				<br/>
				&nbsp;&nbsp;&nbsp;"assessed": "2009/01/01"
				<br/>
				&nbsp;&nbsp;},
				<br/>
				..
				<br/>
				..
				<br/>
				&nbsp;&nbsp;{
				<br/>
				&nbsp;&nbsp;&nbsp;"iucn_species_id": 148255,
				<br/>
				&nbsp;&nbsp;&nbsp;"taxon": "Zosterops everetti",
				<br/>
				&nbsp;&nbsp;&nbsp;"min_presence_id": 2,
				<br/>
				&nbsp;&nbsp;&nbsp;"kingdom": "ANIMALIA",
				<br/>
				&nbsp;&nbsp;&nbsp;"phylum": "CHORDATA",
				<br/>
				&nbsp;&nbsp;&nbsp;"class": "AVES",
				<br/>
				&nbsp;&nbsp;&nbsp;"order": "Passeriformes",
				<br/>
				&nbsp;&nbsp;&nbsp;"family": "Zosteropidae",
				<br/>
				&nbsp;&nbsp;&nbsp;"status": "LC",
				<br/>
				&nbsp;&nbsp;&nbsp;"assessed": "2009/01/01"
				<br/>
				&nbsp;&nbsp;}
				<br/>
				&nbsp;],
				<br/>
				&nbsp;"metaData": {
				<br/>
				&nbsp;&nbsp;"duration": "0:00:00.034309",
				<br/>
				&nbsp;&nbsp;"error": null,
				<br/>
				&nbsp;&nbsp;"idProperty": "iucn_species_id",
				<br/>
				&nbsp;&nbsp;"successProperty": "success",
				<br/>
				&nbsp;&nbsp;"totalProperty": "recordCount",
				<br/>
				&nbsp;&nbsp;"success": true,
				<br/>
				&nbsp;&nbsp;"recordCount": 705,
				<br/>
				&nbsp;&nbsp;"root": "records",
				<br/>
				&nbsp;&nbsp;"fields": [
				<br/>
				&nbsp;&nbsp;&nbsp;{
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"type": "integer",
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"name": "iucn_species_id"
				<br/>
				&nbsp;&nbsp;&nbsp;},
				<br/>
				&nbsp;&nbsp;&nbsp;{
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"type": "string",
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"name": "taxon"
				<br/>
				&nbsp;&nbsp;&nbsp;},
				<br/>
				&nbsp;&nbsp;&nbsp;{
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"type": "integer",
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"name": "min_presence_id"
				<br/>
				&nbsp;&nbsp;&nbsp;},
				<br/>
				&nbsp;&nbsp;&nbsp;{
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"type": "string",
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"name": "kingdom"
				<br/>
				&nbsp;&nbsp;&nbsp;},
				<br/>
				&nbsp;&nbsp;&nbsp;{
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"type": "string",
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"name": "phylum"
				<br/>
				&nbsp;&nbsp;&nbsp;},
				<br/>
				&nbsp;&nbsp;&nbsp;{
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"type": "string",
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"name": "class"
				<br/>
				&nbsp;&nbsp;&nbsp;},
				<br/>
				&nbsp;&nbsp;&nbsp;{
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"type": "string",
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"name": "order"
				<br/>
				&nbsp;&nbsp;&nbsp;},
				<br/>
				&nbsp;&nbsp;&nbsp;{
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"type": "string",
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"name": "family"
				<br/>
				&nbsp;&nbsp;&nbsp;},
				<br/>
				&nbsp;&nbsp;&nbsp;{
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"type": "string",
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"name": "status"
				<br/>
				&nbsp;&nbsp;&nbsp;},
				<br/>
				&nbsp;&nbsp;&nbsp;{
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"type": "string",
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;"name": "assessed"
				<br/>
				&nbsp;&nbsp;&nbsp;}
				<br/>
				&nbsp;&nbsp;]
				<br/>
				&nbsp;}
				<br/>
				}
				<br/>
				<br/>
			</div>
			<h4><a name="metadata">Metadata section</a></h4>
			<div class="normal">
				At the end of the response there is an optional metadata section (this section will only be present if the <span class='param'>includemetadata</span> parameter is true). The metadata section includes information about the actual REST
				service request and includes a fields section which describes all the returned fields and their data types together with a number of other parameters (shown below). The metadata section can be used by developers for working with the schema of the response.
			</div>
			<table class="table" cellspacing="0">
				<tr>
					<th>Name</th><th>Description</th>
				</tr>
				<tr>
					<td>duration</td><td>The duration of the query on the database server (NOTE: this is not the duration of the web response which may be considerably longer due to network issues)</td>
				</tr>
				<tr>
					<td>error</td><td>A detailed description of any errors returned from the server if the call did not succeed (i.e. "success": false).</td>
				</tr>
				<tr>
					<td>idProperty</td><td>The name of the field to use as the unique identifier for the returned data. This field can be used in data aware controls.</td>
				</tr>
				<tr>
					<td>successProperty</td><td>The name of the property in the metaData section that includes if the request was successful or not. This parameter is to support extJS javascript library clients. This value is 'success' by default.</td>
				</tr>
				<tr>
					<td>totalProperty</td><td>The name of the property in the metaData section that includes a count of all of the records returned. This parameter is to support extJS javascript library clients. This value is 'recordCount' by default.</td>
				</tr>
				<tr>
					<td>success</td><td>true if the call was succesful, false if the server returned an error. If an error is returned then the error details will be included in the error section</td>
				</tr>
				<tr>
					<td>recordCount</td><td>The total number of records returned within the records section</td>
				</tr>
				<tr>
					<td>root</td><td>The name of the root element or container in the response that contains all of the actual records.</td>
				</tr>
				<tr>
					<td>fields</td><td>A list of all of the fields that are returned for each record. Each field shows the name of the field and its data type. For more information on return data types see the section below.</td>
				</tr>
			</table>
			<h4><a name="opdt">Output parameter data types</a></h4>
			<div class="normal">
				The following data types are supported for output parameters:
			</div>
			<table class="table" cellspacing="0">
				<tr>
					<th>Data type</th><th>Represents</th>
				</tr>
				<tr>
					<td>boolean</td><td>true or false</td>
				</tr>
				<tr>
					<td>integer</td><td>Positive 4 byte integer value</td>
				</tr>
				<tr>
					<td>number</td><td>&lt;TODO&gt;</td>
				</tr>
				<tr>
					<td>float</td><td>A floating point number currently return to 4 decimal places</td>
				</tr>
				<tr>
					<td>string</td><td>Variable length characer data</td>
				</tr>
				<tr>
					<td>date</td><td>Date only</td>
				</tr>
			</table>
			<h4><a name="rs">Records section</a></h4>
			<div class="normal">
				The records section of the response includes all of the data requested by the REST service call as an array of rows. Each row contains the information requested in the <span class='param'>fields</span> parameter, or all fields if the <span class='param'>fields</span> parameter is not specified. All data will be encoded using the standard encoding for that format.
			</div>
			<h2><a name="consuming">Consuming REST Services</a></h2>
			<h3><a name="websites">Consuming REST services in websites</a></h3>
			<div class="normal">
				REST services can be accessed and used in websites using Javascript by using native Javascript HTTP GET methods or by using Javascript Frameworks, like jQuery or Dojo. The following examples show how to use the REST services from a number of commonly used libraries.
			</div>
			<h4><a name="ud">Using Dojo</a></h4>
			<div class="normal">
				This simple example HTML page shows you how to request a list of species for a protected area and show the number of species found together with the list. The following example can be copy and pasted into <a href='http://jsbin.com' target="_jsbin">JSBin</a> to see it work:
			</div>
			<div class="code">
				&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"&gt;
				<br/>
				&lt;html xmlns="http://www.w3.org/1999/xhtml" lang="en"&gt;
				<br/>
				&nbsp;&lt;head&gt;
				<br/>
				&nbsp;&nbsp;&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
				<br/>
				&nbsp;&nbsp;&lt;title&gt;DOPA REST Client&lt;/title&gt;
				<br/>
				&nbsp;&nbsp;&lt;script src="//ajax.googleapis.com/ajax/libs/dojo/1.8.1/dojo/dojo.js" data-dojo-config="async: true"&gt;&lt;/script&gt;
				<br/>
				&nbsp;&nbsp;&lt;script&gt;
				<br/>
				&nbsp;&nbsp;&nbsp;require(["dojo/request/script", "dojo/_base/array", "dojo/dom"], function(script, arrayUtil, dom) {
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;script.get("http://dopa-services.jrc.ec.europa.eu/services/ibex/especies/get_pa_species_list?wdpa_id=785&category=EN,VU", {
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jsonp : "callback"
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;}).then(function(response) {
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;species ='';
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arrayUtil.forEach(response.records, function(item){
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;species += item.taxon + '&lt;br&gt;';
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dom.byId("feedback").innerHTML = "There are " + response.metadata.recordCount + " species:&lt;br/&gt;" + species;
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;}, function(err) {
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Handle the error condition
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;});
				<br/>
				&nbsp;&nbsp;&nbsp;});
				<br/>
				&nbsp;&nbsp;&lt;/script&gt;
				<br/>
				&nbsp;&lt;/head&gt;
				<br/>
				&nbsp;&lt;body&gt;
				<br/>
				&nbsp;&nbsp;&lt;div id='feedback'&gt;&lt;/div&gt;&nbsp;&nbsp;
				<br/>
				&nbsp;&lt;/body&gt;
				<br/>
				&lt;/html&gt;
				<br/>
			</div>
			<h4><a name="ue">Using extJS</a></h4>
			<div class="normal"></div>
			<div class="normal">
				The following example HTML page shows you how to request a information from a REST service and put that into an extJS chart. The following example can be copy and pasted into <a href='http://jsbin.com' target="_jsbin">JSBin</a> to see it work:
			</div>
			<div class="code">
				&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"&gt;
				<br/>
				&lt;html xmlns="http://www.w3.org/1999/xhtml" lang="en"&gt;
				<br/>
				&nbsp;&lt;head&gt;
				<br/>
				&nbsp;&nbsp;&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
				<br/>
				&nbsp;&nbsp;&lt;title&gt;DOPA REST Client&lt;/title&gt;
				<br/>
				&nbsp;&nbsp;&lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
				<br/>
				&nbsp;&nbsp;&lt;script src=&quot;http://extjs.cachefly.net/ext-3.4.0/adapter/ext/ext-base.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
				<br/>
				&nbsp;&nbsp;&lt;script src=&quot;http://extjs.cachefly.net/ext-3.4.0/ext-all.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
				<br/>
				&nbsp;&nbsp;&lt;script src=&quot;http://code.highcharts.com/2.3.2/highcharts.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
				<br/>
				&nbsp;&nbsp;&lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot;&gt;
				<br/>
				&nbsp;&nbsp;&nbsp;Ext.onReady(function() {
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;var chartOptions = {
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chart : {
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renderTo : &#39;container&#39;,
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type : &#39;column&#39;
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yAxis : {
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title : {
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text : &#39;Agricultural pressure&#39;
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xAxis : {
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title : {
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text : &#39;Ranking for Tanzania&#39;
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;series : [{
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data : [],
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}]
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;};
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;var datastore = new Ext.data.Store({
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;autoDestroy : true,
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;autoLoad : {
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params : {
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;countryid&#39; : 834,
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;parseparams&#39; : false,
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;metadataname&#39; : &#39;metaData&#39;
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callback : function(records) {
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ext.each(records, function(item) {
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chartOptions.series[0].data.push([String(item.get(&#39;wdpa_id&#39;)), item.get(&#39;normalised_ap&#39;)]);
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}, this);
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var chart = new Highcharts.Chart(chartOptions);
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy : new Ext.data.ScriptTagProxy({
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method : &#39;GET&#39;,
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url : &#39;http://dopa-services.jrc.ec.europa.eu/services/ibex/ehabitat/get_agri_pressure_country&#39;,
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}),
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reader : new Ext.data.JsonReader()
				<br/>
				&nbsp;&nbsp;&nbsp;&nbsp;});
				<br/>
				&nbsp;&nbsp;&nbsp;});
				<br/>
				&nbsp;&nbsp;&lt;/script&gt;
				<br/>
				&nbsp;&lt;/head&gt;
				<br/>
				&nbsp;&lt;body&gt;
				<br/>
				&nbsp;&nbsp;&lt;div id=&quot;container&quot; style=&quot;min-width: 400px; height: 400px; margin: 0 auto&quot;&gt;&lt;/div&gt;
				<br/>
				&nbsp;&lt;/body&gt;
				<br/>
				&lt;/html&gt;
				<br/>
			</div>
			<h3><a name="desktop">Consuming REST services in desktop tools</a></h3>
			<div class="normal">
				The REST services can also be used in desktop applications, such as Microsoft Office, by using the service endpoint. For many desktop applications the <span class='param'>format</span> parameter should specified as xml.
			</div>
			<h4>Importing data into Microsoft Excel</h4>
			<div class="normal">
				The following walkthrough shows you how to use the REST services in Microsoft Excel 2010 by retrieving a list of species for a protected area:
			</div>
			<ol>
				<li>
					Open Microsoft Excel 2010 and click on the Data tab
				</li>
				<li>
					Click on 'From Other Sources' and select 'From XML Data Import'
				</li>
				<li>
					In the File name text box, enter the endpoint of the REST service that contains the data you require - this is shown in the Example Calls section of the Service Page (e.g. http://dopa-services.jrc.ec.europa.eu/services/ibex/especies/get_pa_species_list?wdpa_id=785&format=xml)
				</li>
				<li>
					Click Open and when prompted select where you want to put the data
				</li>
				<li>
					The data is imported into Excel as a spreadsheet.
				</li>
			</ol>
			<h4>Refreshing data into Microsoft Excel</h4>
			<div class="normal">
				One of the advantages of importing data into Desktop tools is that it can be simply refreshed when the data from the service changes. To update the data in Excel:
			</div>
			<ol>
				<li>
					Open Microsoft Excel 2010 and click on the tab that contains the data you want to update
				</li>
				<li>
					Click on 'Table Tools | Design' and click on 'Refresh'. This will update the data in the spreadsheet using the new data from the server.
				</li>
				<li>
					To update any pivot tables, charts or reports, click on the appropriate tab and click on Refresh
				</li>
			</ol>
			<h2><a name="publishing">Publishing REST Services</a></h2>
			<h3><a name="b2">Background</a></h3>
			<div class="normal">
				The DOPA REST Services Directory makes available in HTML format, functions from a Postgresql database. It supports the following features to expose your data as a REST service:
			</div>
			<ul>
				<li>
					Creates HTML pages from schemas and functions in a Postgresql database
				</li>
				<li>
					Publishes the descriptions as HTML for functions and function parameters based on COMMENTS in the database
				</li>
				<li>
					Creates a service page for each function in a postgresql schema including information on the parameters, descriptions, types and default values
				</li>
				<li>
					Creates sample REST service calls for each service
				</li>
			</ul>
			<div class="normal">
				To take advantage of these features you simply need to create a function in Postgresql with a description. Optionally you can add additional information to the function such as parameter descriptions.
			</div>
			<h3><a name="sbssp">Step-by-step service publishing</a></h3>
			<h4>Create the Function to publish</h4>
			<div class="normal">
				In Postgresql, create a normal database function to retrieve data, optionally with a number of input parameters.
				The name of the function will determine its visiblity within the REST Services Directory. Currently functions that begin with 'get', 'set' or 'insert' are shown in the REST Services Directory. In addition, if a function begins with an underscore it will only be shown internally and not on the publically visible REST Services Directory. This can be useful for debugging/testing purposes.
				In addition, the function must be accessible using the restuser account.
			</div>
			<h4>Define the input parameters</h4>
			<div class="normal">
				Any input parameters in your function will automatically be shown in the REST Services Directory. Parameter names cannot be Postgresql reserved words, e.g. user, value. If you want to include default parameters in your REST service then you need to implement them in your function. For example:
			</div>
			<div class="code">
				CREATE OR REPLACE FUNCTION getcountryspeciescount(country_id integer, presence_id integer[] DEFAULT ARRAY[1,2,3]) RETURNS bigint AS ..
			</div>
			<div class="normal">
				NOTE: There is a bug in pgAdmin that prevents you from recreating a function with a default value of ARRAY[1,2,3]. You will need to edit the CREATE script that is generated by pgAdmin to correctly create a function with a default value of an ARRAY.
			</div>
			<h4>Define the return parameters</h4>
			<h5>Scalar type</h5>
			<div class="normal">
				If you want to return simple scalar data then define the output as a simple data type. For example:
			</div>
			<div class="code">
				CREATE OR REPLACE FUNCTION getcountryspeciescount(country_id integer, presence_id integer[]) RETURNS bigint AS ..
			</div>
			<div class="normal">
				This will return a single value with the name of the function by default (e.g. in this case {"getcountryspeciescount": 425}). If you want to specify a name for the return value then you will need to name it as an OUT parameter:
			</div>
			<div class="code">
				CREATE OR REPLACE FUNCTION getcountryspeciescount(IN country_id integer, IN presence_id integer[], OUT spcount bigint) RETURNS bigint AS ..
			</div>
			<h5>Table type</h5>
			<div class="normal">
				To return data with a specific schema, define a TABLE return data type (see <a href='http://www.postgresql.org/docs/9.1/static/sql-createfunction.html' target='_ext'>here</a> for more information). For example:
			</div>
			<div class="code">
				CREATE OR REPLACE FUNCTION getirreplacibilityindices(IN wdpa_id integer) RETURNS TABLE(taxonomic_group character varying, irreplacibility_score double precision) AS ..
			</div>
			<div class="normal">
				If your function returns all fields from a particular table (for example 'select * from &lt;tablename&gt;) then if you modify your table definition by adding fields then service call will fail because the new schema of the table will not match the functions declared return type. To prevent this, specify the names of the fields in the sql rather than using a wildcard *. If you want your service to be accessible using data-aware controls you will also need to supply a unique identifier with your response. By default the idProperty in the Response metadata lists the first field that is returned as the id field. So in this case you will need to ensure that the id field is returned first.
			</div>
			<h4>Write a description for the function</h4>
			<div class="normal">
				By default if a function is not commented then it will not be shown in the Services Directory. Create comments for functions using the usual COMMENT statement. For example:
			</div>
			<div class="code">
				COMMENT ON FUNCTION getspeciespalist(bigint) IS 'Returns a list of protected areas that a species range intersects with.';
			</div>
			<h4>Specify the field that contains a unique identifier (optional)</h4>
			<div class="normal">
				If your data contains a field which is a unique identifier then this should be the first field in the return data. The name of this field will also be returned in the metadata sections 'idProperty' value. Many Javascript client libraries need a unique identifier to be present in the returned data.
			</div>
			<h4>Write a description for the function parameters (<i>optional</i>)</h4>
			<div class="normal">
				There is currently no mechanism to provide comments or descriptions for function parameters in Postgresql so a workaround has had to be developed which involves writing the comments for the function parameters in the comment for the function. The syntax for doing this is:
			</div>
			<div class="code">
				COMMENT ON FUNCTION &lt;<i>functionname</i>&gt; IS '&lt;<i>function description</i>&gt; {&lt;<i>param description 1</i>&gt;$$&lt;<i>param description 2</i>&gt;$$&lt;<i>param description 3</i>&gt; etc. }';
			</div>
			<div class="normal">
				Parameter descriptions are given inside braces {} and each parameter description is separated using a dollar sign $$. These descriptions are optional and if they are not given then 'No Description' appears alongside the parameter in the REST Services Directory.
				Parameter descriptions can also include HTML markup and so, for example, you can include links in your descriptions for functions or function parameters. However, all apostrophes will need to be escaped using the Postgresql escaping of a single quote. So for
				example, the following comment includes full escaping to include hyperlinks in the COMMENT for a function:
			</div>
			<div class="code">
				COMMENT ON FUNCTION getspeciespalist(bigint) IS 'Returns a list of protected areas that a species range intersects with.{IUCN Species Identifier from the Red List website. To find the IUCN Species Identifier, search for a species and
				then look for the number in the URL, e.g. Orang Utan is 17975$$The unique identifier for the protected area as shown in the protectedplanet.net website. See the &lt;a href=''http://protectedplanet.net'' target=''_protectedplanet''/&gt;Protected Planet
				website&lt;/a&gt; for more information$$The country for the protected area$$The name of the protected area$$The designation for the protected area$$The IUCN Category for the protected area taken from the following values:
				&lt;br/&gt;Ia: Strict Nature Reserve, Ib: Wilderness Area, II: National Park, III: Natural Monument or Feature, IV: Habitat/Species Management Area, V: Protected Landscape/Seascape, VI: Protected area with sustainable use of natural resources
				(see &lt;a href=''http://www.unep-wcmc.org/iucn-protected-area-management-categories_591.html'' target=''wcmc''&gt;here&lt;/a&gt; for more information)}';
			</div>
			<div class="normal">
				If only some parameters have a description available then all of the rest of the parameters will appear with 'No Description' beside the parameter name in the Services Directory.
			</div>
			<!-- <h3><a name="hadoop">Publishing Hadoop resources using a Postgresql wrapper</a></h3>
			<div class="normal">
				Hadoop resources can be published to the REST Services Directory with a little extra effort to create a wrapper function and some additional wiring to the Hadoop resource. This is needed as the Hadoop functions are called asynchronously rather than synchronously like normal Postgresql
				resources. To publish a Hadopp resource, follow these steps:
			</div>
			<ul>
				<li>
					Create the wrapper function in Postgresql in the same way as you would create a normal REST Service as outlined above. However, do not include a return statement in the Postgresql sql. Append the suffix '_h' to the end of the function name
				</li>
				<li>
					When the service is called, the Hadoop Python wrapper function <em>with the same name</em> as the REST service is called and the results are returned to the
				</li>
			</ul> -->			<h3><a name="lac">Licensing and Copyright</a></h3>
			<div class="normal">
				When publishing services into the REST Services Directory, particular care must be taken to abide by any license or copyright restrictions, particularly where data has been derived directly from an external partner. Currently JRC are not licensed to
				redeliver any spatial data from external partners including IUCN and UNEP-WCMC.
			</div>
			<h2><a name="s">Support</a></h2>
			<div class="normal">
				For support/comments/amendments please email: <a href="mailto:andrew.cottam@jrc.ec.europa.eu">andrew.cottam@jrc.ec.europa.eu</a>
			</div>
		</div>
	</body>
</html>